---
layout: section
---
ifdef::backend-html5[]
:notitle:
:description:
:author:
:email: jenkinsci-users@googlegroups.com
:sectanchors:
:toc: left
endif::[]

= Managing systemd services

Beginning with Jenkins 2.332.1 and Jenkins 2.335, the Linux package installers use `systemd` to manage services.
The RPM and deb package installers migrate configuration settings from System V `init` to `systemd` overrides.

== Viewing service configurations

The current service configuration of the Jenkins service as configured by the package installers and any overrides can be viewed with:

[source,bash]
----
$ systemctl cat jenkins
# /etc/systemd/system/jenkins.service
#
# This file is managed by systemd(1). Do NOT edit this file manually!
# To override these settings, run:
#
#     systemctl edit jenkins
#
# For more information about drop-in files, see:
#
#     https://www.freedesktop.org/software/systemd/man/systemd.unit.html
#

[Unit]
Description=Jenkins Continuous Integration Server
Requires=network.target
After=network.target

[Service]
Type=notify
NotifyAccess=main
ExecStart=/usr/bin/jenkins
Restart=on-failure
SuccessExitStatus=143

# /etc/systemd/system/jenkins.service.d/override.conf
[Service]
Environment="JAVA_OPTS=-Djava.awt.headless=true"
----

== Overriding service configurations

When installed on a modern Linux distribution running `systemd(1)`, the `systemd(1)` link:https://www.freedesktop.org/software/systemd/man/systemd.service.html[service unit] is delivered to:

Debian:: `/lib/systemd/system/jenkins.service`
Red Hat:: `/usr/lib/systemd/system/jenkins.service`
openSUSE:: `/usr/lib/systemd/system/jenkins.service`

The main service unit is read-only and not intended to be edited manually,
and it contains a large notice at the top of the file stating as much.

Values may be overridden in the drop-in unit (`override.conf` file) for the service.
Edit the drop-in unit with:

[source,bash]
----
# systemctl edit jenkins
----

The `override.conf` file is stored at `/etc/systemd/system/jenkins.service.d/override.conf` and can be used to customize the service.
Note that such customizations must be done in a `[Service]` section in order to take effect.
Example content of the `override.conf` file might include:

[source]
----
[Unit]
Description=My Company Jenkins Controller

[Service]
# Add JVM configuration options
Environment="JAVA_OPTS=-Djava.awt.headless=true -XX:+UseStringDeduplication"

# Arbitrary additional arguments to pass to Jenkins.
# Full option list: java -jar jenkins.war --help
Environment="JENKINS_OPTS=--prefix=/jenkins --javaHome=/opt/jdk-11"

# Configuration as code directory
Environment="CASC_JENKINS_CONFIG=/var/lib/jenkins/configuration-as-code/"
----

WARNING: `systemctl edit jenkins` creates the drop-in unit as `root` with 0644 (`-rw-r--r--`) permissions.
The migration logic, on the other hand, creates the drop-in unit as `root` with 0600 (`-rw-------`) permissions.
This might be of consequence if you store an HTTPS keystore location and/or password in the drop-in unit
and also run jobs directly on the controller,
a practice which the Jenkins project link:https://www.jenkins.io/doc/book/security/controller-isolation/[explicitly discourages].
When in doubt, secure the drop-in unit by settings its permissions to 0600 with `chmod(1)`.

The drop-in unit unifies configuration across all three distributions: Debian, Red Hat, and openSUSE.
Also note that the drop-in unit is not overwritten on upgrades.

NOTE: Unlike the System V `init(8)` configuration, the `override.conf` file only contains customizations, not the original defaults.
Users who are accustomed to editing an existing set of defaults must refer to the (read-only) service unit side-by-side when editing the drop-in unit
or use a command like `systemctl edit jenkins --full`, which copies the original service unit instead of creating a drop-in unit.

A final point to mention about the service unit is its use of specifiers,
which may be unfamiliar to some users.
The `systemd(1)` documentation contains link:https://www.freedesktop.org/software/systemd/man/systemd.unit.html#id-1.13.3[a table of specifiers available in unit files].

== Starting services

Once the Jenkins `systemd` service has been defined, it can be started with:

[source,bash]
----
# systemctl start jenkins
----

== Stopping services

The Jenkins `systemd` service can be stopped with:

[source,bash]
----
# systemctl stop jenkins
----

== Reloading service definitions

After changes to configuration files, the service definition may need to be reloaaded with:

[source,bash]
----
# systemctl daemon-reload
----

== Reading service logs

Logs for the Jenkins service can be read with the command:

[source,bash]
----
$ journalctl -u jenkins
----

== Pruning service logs

Log files retained by `systemd` are commonly configured to automatically rotate.
If the log files need to be reduced in size, use the command:

[source,bash]
----
$ journalctl --vacuum-size=500M
----

== Going further

Some recommended readings on this subject:

* link:https://www.digitalocean.com/community/tutorials/how-to-use-systemctl-to-manage-systemd-services-and-units[DigitalOcean systemd services and units tutorial]
* link:https://docs.fedoraproject.org/en-US/quick-docs/understanding-and-administering-systemd/[Understand and administering systemd] by the Fedora project
* link:https://www.freedesktop.org/wiki/Software/systemd/[systemd reference documentation] from freedesktop.org
* link:https://wiki.debian.org/systemd[Debian wiki: systemd]
