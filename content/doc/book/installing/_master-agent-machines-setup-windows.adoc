[[master-agent-setup-windows]]
== Step by step guide to set up master and agent machines on Windows

Note: There is no need to install Jenkins on the agent machine.

. On your master machine go to *Manage Jenkins* > *Manage Nodes*. +
[.confluence-embedded-file-wrapper .confluence-embedded-manual-size]#image:installing/ManageNodes.PNG[image,width=500]# +

. *New Node*
.. *Enter Node Name*
.. *Select Permanent Agent* 
.. Press *OK*. +
[.confluence-embedded-file-wrapper .confluence-embedded-manual-size]#image:installing/NewNode.PNG[image,height=250]# +
 +
. Fill out the following:
.. Set a *number of executors* 
... (one or more) as needed.
.. Set a *Remote FS Root*
... a home directory for the master on the agent machine.
... For a _Windows agent_, use something like: "C:\Jenkins\"
.. Select the appropriate *Usage* setting:
... For an additional worker: _Utilize this node as much as possible_
... For specialized jobs: _Leave this machine for tied jobs only_
.. *Launch Method*:
... An easy way to control a Windows agent is by using _Launch agent via
Java Web Start_  (Recommended for Windows)
... TODO: add steps for other methods.
.. *Availability* 
... _Keep this agent online as much as possible_
... TODO: add details for each option.
.. Press *OK*. +
[.confluence-embedded-file-wrapper .confluence-embedded-manual-size]#image:installing/setup06.png[image,height=150]#
. Now you need to connect your agent machine to the master using the
following steps.  +
.. Open a browser on the **agent*** machine* and go to the *Jenkins
master server* url
(http://yourjenkinsmaster:8080/[http://yourjenkinsmaster:8080]).
.. Go to *Manage Jenkins* > *Manage Nodes*, 
... Click on the newly created agent machine. You will need to login as
someone that has the "Connect" Agent permission if you have configured
global security.
.. Click on the *Launch* button to launch agent from browser on agent. +
[.confluence-embedded-file-wrapper .confluence-embedded-manual-size]#image:installing/setup03.png[image,width=402,height=145]#
.. Run the program. +
[.confluence-embedded-file-wrapper .confluence-embedded-manual-size]#image:installing/setup04.png[image,height=150]# +
If Windows asks you to choose a program,
use `+$JAVA_HOME\bin\javaws.exe+` (the Java Web Start Launcher).
.. If you encounter connection issue, then you could enlarge the popup
windows to see the master *port used* and check your network
configuration (firewall, port forward, ...).  +
[.confluence-embedded-file-wrapper .confluence-embedded-manual-size]#image:installing/connect.jpg[image,height=150]# +
Note that Jenkins chooses a random, high-number port. If you want
Jenkins to use a static port, go to "Manage Jenkins" > "Configure Global
Security" and choose the port number in the "TCP port for JNLP agents"
box.
.. If the port is open, the agent still can't connect, and your Jenkins
instance is served securely over SSL/HTTPS, download and install
the http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html[Java
Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy
Files 8]. Take the .jar files and save them
to `+$JAVA_HOME\lib\security+`. Try the above steps again.
.. Now you should see the agent machine connected under *Nodes*.

                 
 [.confluence-embedded-file-wrapper .confluence-embedded-manual-size]#image:installing/Node.PNG[image,width=300]#


.  If you want the service to run on start-up of the agent machine do
the following (Windows only directions):
.. In the agent program running on your agent machine, 
.. click *File* --> *Install as Windows Service. * +
[.confluence-embedded-file-wrapper]#image:installing/setup05.png[image]# +
Note that this feature requires ".Net Framework 3.5" +
[.confluence-embedded-file-wrapper]#image:installing/dotNet3_5Features.JPG[image]#
.. *Start*, type Services and Select the *Services* program.
.. Find *Jenkins Agent* in the list, Double click to open.
.. Select *Startup type* --> *Automatic*.
.. Go to the *Log On* tab, change the *Log on as* to a user of your
choice (Special user account Jenkins recommended).
.. Make sure that auto login is set for the agent machine for the user
account, then the VM (or physical computer) should connect and be
available when needed.

TODO: Add steps for connecting via ssh

Also: take a look at https://wiki.jenkins.io/display/JENKINS/Distributed+builds[Distributed
builds]
