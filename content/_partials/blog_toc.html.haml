-# This partial builds a table-of-contents for blog posts by scanning headings
-# within the rendered content. It is included from the post layout and only
-# generates markup when a `.blog-content` element is present (i.e. on blog
-# article pages). The actual HTML list is inserted into the `.app-post-wrapper`.

:javascript
  document.addEventListener('DOMContentLoaded', function() {
    var content = document.querySelector('.blog-content');
    if (!content) return;

    var headings = content.querySelectorAll('h2, h3, h4');
    if (headings.length === 0) return;

    // try to reuse an existing placeholder if present
    var toc = document.querySelector('.blog-toc');
    if (!toc) {
      toc = document.createElement('aside');
      toc.className = 'blog-toc';
      toc.setAttribute('aria-label', 'Table of contents');
      var nav = document.createElement('nav');
      var title = document.createElement('h2');
      title.textContent = 'Table of contents';
      nav.appendChild(title);
      var newUl = document.createElement('ul');
      newUl.id = 'blog-toc-list';
      nav.appendChild(newUl);
      toc.appendChild(nav);
    }

    var list = toc.querySelector('#blog-toc-list');
    if (!list) {
      list = document.createElement('ul');
      list.id = 'blog-toc-list';
      toc.appendChild(list);
    }
    list.innerHTML = '';

    headings.forEach(function(h) {
      if (!h.id) return;
      var li = document.createElement('li');
      li.className = 'toc-' + h.tagName.toLowerCase();
      var a = document.createElement('a');
      a.href = '#' + h.id;
      a.textContent = h.textContent;
      li.appendChild(a);
      list.appendChild(li);
    });

    var wrapper = document.querySelector('.app-post-wrapper');
    if (wrapper && !wrapper.contains(toc)) {
      wrapper.insertBefore(toc, wrapper.firstChild);
    }
  });
