---
layout: post
title: "Use Terraform with External Workspace Manager to Support EFS"
tags:
- jenkins
- gsoc
author: imaffe
description: "A brief example of using Terraform with EFS" # optional
opengraph:
  image: /images/folder/icon.png # optional
---

=== Why you want to use External Workspace Manager with EFS
What is Terraform : A CasC software, like CloudFormation and Ansible designed for managing cloud resources. It can free you from managing cloud resource by console, and can be version controlled using git as it is configuration-as-code. Currently it supports AWS and Azure best. AWS CloudFormation is for AWS only.
What is extenal-workspace-manager : It is a pipeline plugin let you custom your workspace path, you can mount shared disk to multiple nodes to share workspaces.
What is EFS : Amazon Elastic File System, an Network File System, can be shared among a lot of EC2 instances.

Who should read this blog : build Jenkins based on cloud, want to have good version control over all resources including infrastructure; You want to share workspace among agents (slaves), this might because you have a upstream job creating a large file and don't want to copy it into downstream job's workspace because it's time-consuming; You're afraid of running out of workspaces, and wants an extensible disk.

Who should not read this blog : 
. Skilled AWS architecture already using CasC tools
. Ops already using CasC and know how to provision EFS to a Jenkins node using user data.
. Running Jenkins in local physical machine, and do not build Jenkins based on Clouds.

What you'll want to do, is to learn external-workspace-manager directly to do similiar things, see blog link : TODO

This tutorial use AWS as example, but other clouds like Google Cloud, Microsoft Azure are also supported. (same mechanism, different syntax), and here we go.

=== Define a master Jenkins EC2

Terraform use its own DSL, tutorial can be found : , but you don't need to worry about the syntaxes. You only need to know the concept of CasC, then you can use any CasC with any cloud providers or even other services. To define an EC2 instance, we define 


